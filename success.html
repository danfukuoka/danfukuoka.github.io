<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OIDC Flow Success</title>
</head>
<body>
    <h1>Token Exchange Successful</h1>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Function to extract query parameters from URL
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // On page load, check for authorization code in URL
        document.addEventListener('DOMContentLoaded', function() {
            const authorizationCode = getParameterByName('code');

            if (authorizationCode) {
                const clientId = '9999efa7-f814-40df-85fc-b61011a764b9'; // Your client ID
                const clientSecret = 'your_client_secret'; // Your client secret
                const redirectUri = 'https://danfukuoka.github.io/success.html'; // Your redirect URI
                const codeVerifier = 'hello-world'; // Your code verifier (if using PKCE)

                // Token endpoint URL using CORS Anywhere as proxy
                const tokenEndpoint = `https://cors-anywhere.herokuapp.com/https://login.microsoftonline.com/{tenant_id}/oauth2/v2.0/token`;

                // Token exchange data
                const tokenExchangeData = {
                    code: authorizationCode,
                    client_id: clientId,
                    client_secret: clientSecret,
                    code_verifier: codeVerifier,
                    redirect_uri: redirectUri,
                    grant_type: 'authorization_code'
                };

                // Perform token exchange
                axios.post(tokenEndpoint, tokenExchangeData)
                    .then(response => {
                        console.log(response.data);
                        // Display or process tokens as needed
                    })
                    .catch(error => {
                        console.error('Error exchanging authorization code:', error);
                        alert('Error exchanging authorization code. Check console for details.');
                    });
            }
        });
    </script>
</body>
</html>
